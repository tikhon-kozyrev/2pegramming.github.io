<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Как визуализировать схему базы данных &middot; 
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-00">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          
        </a>
      </h1>
      <p class="lead"><a href="https://t.me/pepegramming" target="_blank">2pegramming</a></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Главная</a>

      <a class="sidebar-nav-item" href="/blogposts">Посты</a>
      <!-- <a class="sidebar&#45;nav&#45;item" href="/streams">Стримы</a> -->
      <!-- <a class="sidebar&#45;nav&#45;item" href="/questions">Ответы на вопросы</a> -->
      <a class="sidebar-nav-item" href="https://goo.gl/forms/iUd1Gufq6WnTsaO62">Обратная связь</a>
      <a class="sidebar-nav-item" href="http://github.com/2pegramming">GitHub</a>
    </nav>

    <p>&copy; 2024. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="question">
  <h1 class="question-title">Как визуализировать схему базы данных</h1>
  <span class="question-date">01 Aug 2024</span>

  <div class="message">
    <p>Этот пост является ответом на вопрос из канала <a href="https://t.me/pepegramming/">pepegramming</a>. Если увидите не точность или захотите что-то добавить – буду рад комментариями в канале.</p>
    <p>Если нашли опечатку – <a href="https://github.com/2pegramming/2pegramming.github.io/tree/master/questions/_posts">можно отправить PR с исправлениями</a></p>
  </div>

  <hr>

  <ul><li><a href="#вопрос">Вопрос</a></li><li><a href="#data-modelling">Data modelling</a></li><li><a href="#случай-1-проект-только-в-голове-и-хочется-понять-как-связаны-данные-между-собой">Случай 1: Проект только в голове и хочется понять как связаны данные между собой</a><ul><li><a href="#виды-нотаций-концептуальных-моделей">Виды нотаций концептуальных моделей</a></li><li><a href="#что-сам-использую">Что сам использую</a></li><li><a href="#советы-для-моделирования-данных-не-схемы-бд">Советы для моделирования данных (не схемы бд)</a></li></ul></li><li><a href="#случай-2-проект-уже-реализован-в-коде-и-хочется-понять-что-из-себя-представляет-схема-бд">Случай 2: Проект уже реализован в коде и хочется понять, что из себя представляет схема бд</a><ul><li><a href="#генерация-модели-из-кода">Генерация модели из кода</a></li><li><a href="#генерация-erd-в-инструментах-для-диаграм">Генерация ERD в инструментах для диаграм</a></li><li><a href="#использование-dbml">Использование dbml</a></li><li><a href="#генерация-из-редактораide">Генерация из редактора/IDE</a></li></ul></li><li><a href="#итоги">Итоги</a></li><li><a href="#что-еще-почитать-по-теме">Что еще почитать по теме</a></li></ul>

  <h2 id="вопрос">Вопрос</h2>

<div class="question-text">
  <blockquote>
    <p>«Возникла проблема, что нужно визуализировать данные, но не понятно с чего начать. Что в таких случаях делаешь и какие есть инструменты для этого?»</p>
  </blockquote>
</div>

<p>Так как вопрос без конкретики, выделю два случая:</p>
<ol>
  <li>Проект только в голове и хочется понять как связаны данные между собой</li>
  <li>Проект уже реализован в коде и хочется понять, что из себя представляет схема бд</li>
</ol>

<p>Поэтому, вместо короткого ответа «используй ERD», поговорим о каждом из вариантов. Но сначала разберемся с data modelling, благодаря которому можно определить нужный вид диаграммы для задачи.</p>

<h2 id="data-modelling">Data modelling</h2>

<p>Может показаться, что взять и начать фигачить SQL схему описывающую данные для проекта может быть разумной идеей. На деле это не так:</p>

<ul>
  <li>Так как нет структуры данных в голове, можно запутаться и упороться в вечное редактирование. А если данных много и связей еще больше - получится хаос который не влезет в голову;</li>
  <li>Полученную модель данных придется валидировать, причем с бизнесом/доменным экспертом. Не разработчикам будет сложно и валидация может затянуться;</li>
  <li>Когнитивная нагрузка увеличивается: работая с текстом, придется этот текст представить в виде модели в голове и потом обратно, из модели в текст;</li>
</ul>

<figure class="image">
  <img src="/public/images/questions/2024-08-01-data-model/schema-vs-visualisation.jpg" alt="dbml: code and visualisation" />
  <figcaption><p>Слева - схема в dbml, которая представлена в виде диаграммы (справа). Когда разбираешься с новым проектом – мне проще сразу картинкой (моделью) оперировать</p>
</figcaption>
</figure>

<p>В целом, выглядит надежно, как швейцарские часы. Поэтому придумали процесс, который назвали <a href="https://en.wikipedia.org/wiki/Data_model">data modeling</a>. Data modeling помогает с определением релевантных для системы данных, связью между этими данными и как данные работают вместе, т.е. создать data model для системы. Главное, что стоит вынести из этой идеи – моделирование можно разбить на три «перспективы»:</p>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Conceptual_schema">Концептуальная</a> говорит о том, какие данные используются системой и как данные связаны между собой. Т.е. тут о том, что необходимо бизнесу без привязки к конкретной реализации хранения данных в конкретной бд</li>
  <li><a href="https://en.wikipedia.org/wiki/Logical_schema">Логическая</a> говорит о том, как данные структурируются в приложении. Т.е. берем любой язык описания схемы (будь то SQL, dbml или еще что) и описываем таблицы/колонки/классы/etc.</li>
  <li><a href="https://en.wikipedia.org/wiki/Physical_schema">Физическая</a> говорит о том, как данные физически храниться будут. Т.е. берем логическое описание и говорим где данные будут находиться физически и как все будет работать в реальности;</li>
</ul>

<figure class="image">
  <img src="/public/images/questions/2024-08-01-data-model/conceptual-vs-logical-models.jpg" alt="dbml: code and visualisation" />
  <figcaption><p>Сравнение концептуальной (правая) и логической (левая) схем, где пример из самого начала. Возможно, я сделал концептуальную модель не корректно, но задача показать идею, а не сделать корректную модель</p>
</figcaption>
</figure>

<p>При использовании концептуальной модели данных можно отказаться от «технической» информации и оставить только необходимое для реализации бизнесовой модели. Т.е. можно не запариваться с pk, fk и <code class="language-plaintext highlighter-rouge">created_at</code> для каждого объекта и не думать о таблицах. Так, в примере выше, указан продукт как «элемент», к которому привязаны отдельные «элементы»: цена, тег и статус. Эта информация необходима для бизнес логики, хотя в реальности, если опуститься на логический уровень – данные оказываются в одной таблице.</p>

<p>Теперь, используя информацию о data modeling, можно вернуться к оригинальному вопросу.</p>

<h2 id="случай-1-проект-только-в-голове-и-хочется-понять-как-связаны-данные-между-собой">Случай 1: Проект только в голове и хочется понять как связаны данные между собой</h2>

<p>Возможно бизнес с нуля делает систему, либо же нужно разобраться в уже работающей бизнес логике (доменной модели). Для этого придется разбираться с данными: какие элементы, как элементы связаны. Если в этот момент думать о том, где какая таблица будет и что в этой таблице должно находиться – выглядит как доп нагрузка которая усложняет работу. Поэтому для первого случая концептуальное представление предпочтительнее: меньше когнитивная нагрузка, проще работать, можно показать бизнесу не объясняя что это за <a href="https://www.datensen.com/blog/er-diagram/one-to-many-relationships/">вилка</a>.</p>

<h3 id="виды-нотаций-концептуальных-моделей">Виды нотаций концептуальных моделей</h3>

<p>Тут список может быть большой, опишу только то, что сам знаю и видел. Подробно на каждой нотации останавливаться не буду, оставлю это на самостоятельное изучение.</p>

<ul>
  <li><a href="https://studme.org/77224/informatika/notatsiya_idef">Нотация IDEF 1х</a></li>
  <li><a href="https://studme.org/77225/informatika/notatsiya_uml">PlantUml</a>, тут используется <a href="https://en.wikipedia.org/wiki/Class_diagram">class diagram</a>, что сомнительно, но для общего развития пусть будет.</li>
  <li>Cтоит упомянуть <a href="http://www.modelsphere.com/org/index.html">Open ModelSphere</a>, это oss инструмент, который помогает с моделированием данных не только концептуально, но и логически/физически
 
Отдельно хочется рассказать еще о двух нотациях:</li>
</ul>

<p>Первая нотация – <a href="https://en.wikipedia.org/wiki/Entity–relationship_model">ER model</a> (иногда встречается как <a href="https://studme.org/77222/informatika/notatsiya_pitera_chena">нотация Питера Чена</a>) и тут важно не путать с ER diagram. Модель создана Питером Ченом в 1976 году для абстрактного описания данных. При этом, модель предоставляет абстракции для концептуального/логического/физического моделирования. Интересный факт: эта одна из нотаций, которые повлияли на UML.</p>

<p>Вторая – <a href="https://martinfowler.com/books/ap.html">нотация концептуальной модели Мартина Фаулера из книги</a>, о которой преступно мало знают.</p>

<figure class="image">
  <img src="/public/images/questions/2024-08-01-data-model/martin-fowler-notation.jpg" alt="dbml: code and visualisation" />
  <figcaption><p>Так выглядит нотация используемая Фаулером, она описана прямо на первых страницах книги</p>
</figcaption>
</figure>

<p>Что выбрать – решайте сами. Расскажу о том, что сам использую и почему редко использую описанные выше модели.</p>

<h3 id="что-сам-использую">Что сам использую</h3>

<p><a href="https://tough-roadway-bb5.notion.site/1-1-6adfeb2e07eb4269b5966ffb742d7fad#34413c7cc27b4e1da6ee31177875b93b">Я использую сильно упрощенную нотацию, состоящую только из квадратов и стрелок</a>, которую сам и «придумал». При этом, вместо использования сложных видов стрелок, подписываю вид связи который нужен (<code class="language-plaintext highlighter-rouge">has_one</code>, <code class="language-plaintext highlighter-rouge">has_many</code>, <code class="language-plaintext highlighter-rouge">optional_has_one/many</code>, <code class="language-plaintext highlighter-rouge">many_to_many</code>). Плюс использую цветовое обозначение для данных, которые используются в разных контекстах.</p>

<figure class="image">
  <img src="/public/images/questions/2024-08-01-data-model/data-model-example.jpg" alt="dbml: code and visualisation" />
  <figcaption><p>Пример модели из рабочего проекта. Тут кусок модели, <a href="https://vc.ru/fedorandsamat/1103649-kak-my-perezapuskali-medicinskuyu-informacionnuyu-sistemu">связанный с работой дантистов</a></p>
</figcaption>
</figure>

<p>Такой выбор обусловлен двумя причинами:</p>

<ul>
  <li>Концептуальную модель приходится валидировать с бизнесом/доменными экспертами. Чем сложнее нотация, тем больше шансов, что человек запутается. Плюс грузить и без этого занятых людей так себе подход.</li>
  <li>Внимательность – не обо мне, поэтому с большим шансом запутаюсь или пропущу стрелку/форму и по итогу получится фигня. Рисковать и проверять себя по 10 раз не хочется.</li>
</ul>

<p>Если в компании уже есть стандарт, либо хотите использовать распространенный стандарт – лучше забыть эту часть текста и использовать то, что уже принято. Если ничего такого нет, возможно стоит скопировать мое решение, а после, если этого окажется мало, выбрать любую из описанных выше нотаций.</p>

<h3 id="советы-для-моделирования-данных-не-схемы-бд">Советы для моделирования данных (не схемы бд)</h3>

<ul>
  <li>Забудьте о таблицах и реализации в бд. Начните с данных, которые необходимы для работы бизнес модели. Главная причина такого категоричного совета – проще замапить корректную концептуальную модель на реализацию конкретной базы данных, чем упороться с реализацией и потерять важные данные. Это может привести к тому, что решение не будет бизнес задачу решать, а будет подстраиваться под техническое решение, вокруг которого зацепитесь;</li>
  <li>Вытекает из первого совета: в концептуальной модели не нужны данные, которые окажутся в базе данных. Поэтому о <code class="language-plaintext highlighter-rouge">pk</code>, <code class="language-plaintext highlighter-rouge">fk</code>, <code class="language-plaintext highlighter-rouge">created_at</code>, etc можно забыть. Только если это не часть доменной модели;</li>
  <li>Не важно какую нотацию выбрали, модель без легенды – деньги на ветер;</li>
  <li>Валидируете модель с бизнесом/доменным экспертом;</li>
  <li>Между дублированием элементов и уменьшением стрелок – выбирайте дублирование. Так можно снизить когнитивную нагрузку, которая появится из-за стрелочного хаоса. По этой же причине старайтесь избегать пересечения стрелок;</li>
</ul>

<p>С моделированием разобрались. Давайте поговорим о генерации картинок из схемы бд.</p>

<h2 id="случай-2-проект-уже-реализован-в-коде-и-хочется-понять-что-из-себя-представляет-схема-бд">Случай 2: Проект уже реализован в коде и хочется понять, что из себя представляет схема бд</h2>

<p>В данном случае, если нужна концептуальная модель – инструментов не знаю, к сожалению. Поэтому, для проектов с реализованной схемой бд, рисую концептуальные модели «руками».</p>

<p>Но если хватит логической модели, можно найти решение. Из того что знаю – ER diagram (которая, является подмножеством ER model). Существует новомодный dbml, который тоже использовал. Еще стоит упомянуть <a href="https://studme.org/77223/informatika/notatsiya_martina_crows_foot">Нотацию Мартина (Crow’s Foot)</a>, но в живую не наблюдал. Если знаете другие варианты – буду рад комментариями, ибо самому интересно, а быстро нагуглить альтернативы не вышло.</p>

<p>Для генерации «картинки» я использую следующие подходы:</p>

<h3 id="генерация-модели-из-кода">Генерация модели из кода</h3>

<p>В эту секцию входят:</p>
<ul>
  <li>инструменты diagram as a code: <a href="https://graphviz.org/Gallery/neato/ER.html">graphiz</a>, <a href="https://mermaid.js.org/syntax/entityRelationshipDiagram.html">mermaid</a></li>
  <li>библиотеки для разных языков (<a href="https://github.com/drivendataorg/erdantic">python</a>, <a href="https://github.com/voormedia/rails-erd">ruby</a>, <a href="https://github.com/fuelen/ecto_erd">elixir/ecto</a>, <a href="https://github.com/gmarik/go-erd">golang</a>, <a href="https://www.npmjs.com/package/prisma-erd-generator">js/prisma</a>, etc) которые под капотом используют graphiz.</li>
</ul>

<p>С вероятностью в 99% там будет ERD. А подход подойдет в двух случаях:</p>
<ul>
  <li>Если схема данных меньше ~15 таблиц и хочется быстро подключить генератор, а после забыть и получать каждый релиз новый артефакт;</li>
  <li>Если модель нужна для поста или показать идею;</li>
</ul>

<p><strong>Плюсы:</strong></p>

<ul>
  <li>Работает для схем, где таблиц меньше ~15 или когда связей мало между таблицами;</li>
  <li>Библиотеки работают из коробки и легко настраиваются;</li>
  <li>Если говорим о библиотеках – нет проблем с обновлением схемы после изменений, так как генерируется новый файл;</li>
  <li>Легко шарить между коллегами. Отправляем картинку в чат, добавляем в репозиторий или конфлюенс/ноушен/etc;</li>
</ul>

<p><strong>Из минусов:</strong></p>

<ul>
  <li>Нельзя поменять положение элементов или связей. А автоматическая генерация не поддается логике;</li>
  <li>На больших схемах получается не читаемая каша. Особенно, когда дело касается связей;</li>
  <li>Генерируется векторная картинка, если схема увесистая – может шакалить;</li>
</ul>

<h3 id="генерация-erd-в-инструментах-для-диаграм">Генерация ERD в инструментах для диаграм</h3>

<p>Lucidchart предоставляет <a href="https://www.lucidchart.com/pages/examples/er-diagram-tool">инструмент, который генерирует ERD по загруженной схеме бд</a>. Дальше получаете диаграмму, в которой можно двигать элементы, стрелки, добавлять новые элементы, менять цвета и делать что угодно.</p>

<p>Draw.io реализовали <a href="https://www.drawio.com/doc/faq/sql-plugin">аналогичный инструмент</a>. Только для работы придется вставлять SQL код. После, с полученной схемой, также можно производит манипуляции с диаграммой.</p>

<figure class="image">
  <img src="/public/images/questions/2024-08-01-data-model/erd-bad-example.jpg" alt="dbml: code and visualisation" />
  <figcaption><p>Пример сгенерированной ERD в lucidchart. Получи такое картинкой – сразу бы отказался от проекта</p>
</figcaption>
</figure>

<p><strong>Плюсы:</strong></p>

<ul>
  <li>В отличии от векторной картинки – можно делать с полученной моделью что угодно;</li>
  <li>Если не хватит сгенерированных элементов – можно добавить (например стикеры и комментарии);</li>
  <li>Если схема большая – можно двигать каждую связь или элемент, плюс выручает поиск по модели;</li>
</ul>

<p><strong>Из минусов:</strong></p>

<ul>
  <li>Могут теряться связи между элементами, особенно если связи указаны в коде, но не учтены в схеме бд. Пару раз попадался на эту уловку и приходилось руками достраивать модель, что малоприятно;</li>
  <li>Хоть с диаграммой можно делать что угодно, но первичная генерация хаотична. Поэтому для «наведения порядка» придется самостоятельно двигать элементы;</li>
  <li>Специфичный импорт, из-за чего придется под новую версию схемы делать новую диаграмму. А если добавили что-то кастомное, придется дублировать руками;</li>
  <li>Шарить модель может быть проблемно, особенно если используете lucid и душит жаба платить за кучу людей (но для конфлюенса был плагин);</li>
</ul>

<p>Заметка: помните, что генераторы ERD присутствуют не везде. Например, <a href="https://miro.com/diagramming/er-diagram/">в miro нет ERD генераторов</a>, вместо этого, получите только элементы для того, чтобы самостоятельно рисовать модель. </p>

<h3 id="использование-dbml">Использование dbml</h3>

<p>Персональное открытие прошлого года. Вместо рассказа, <a href="https://dbdiagram.io/d">лучше посмотреть самостоятельно</a> (в верхнем левом углу, где лого, можно загрузить advanced sample, который использовался в примерах в начале статьи).</p>

<p>При этом, так как dbml схема типизирована, можно написать конвертер из erd в dbml и получить генерацию схемы из кода (делал так для <a href="https://github.com/voormedia/rails-erd">erd-rails</a> генератора). После, вставляем схему в редактор и изучаем схему баз данных.</p>

<p><strong>Плюсы:</strong></p>

<ul>
  <li>Из-за динамичности, можно двигать элементы, что работает с большими схемами;</li>
  <li>Diagram as a code. Можно <a href="https://dbml.dbdiagram.io/cli#convert--a-sql-file-to-dbml">генерировать dbml схему по SQL</a>, присутствует <a href="https://github.com/stepanic/parse-server-SCHEMA-to-DBML">библиотека для монги (не проверял)</a>, <a href="https://github.com/hamedsj/DbmlForDjango">для джанги</a> библиотека существует;</li>
  <li>Предпросмотр работает в браузере, не надо ничего ставить локально;</li>
  <li>Так как генерация из кода – можно избежать ситуации, когда связи не отображаются, так как связей нет в схеме бд, но есть на уровне кода;
  
&lt;/br&gt;</li>
</ul>

<p><strong>Из минусов:</strong></p>

<ul>
  <li>Нет нормальной экосистемы. Библиотеки придется писать самому, в частности для мало популярных языков;</li>
  <li>Еще один язык описания схемы, который придется изучить;</li>
  <li>Если хотите хранить и смотреть модели командой, придется платить. Хотите селфхостед – на 2023 год находил аналоги, но каждый оставлял желать лучшего;</li>
</ul>

<h3 id="генерация-из-редактораide">Генерация из редактора/IDE</h3>

<p>Так как всю жизнь просидел в vim, без возможности выхода, то особо ничего сказать о генерации схем из редактора и инструментов для этого. Знаю, что инструменты существуют и пользователи jetbrains <a href="https://www.jetbrains.com/help/datagrip/creating-diagrams.html#db_diagrams">могут смотреть на схему не выходя из редактора</a>. Лучше погуглить самостоятельно.</p>

<h2 id="итоги">Итоги</h2>

<p>Если необходимо смоделировать данные, то важно разобраться с целью модели, так как каждое представление закрывает определенные потребности:</p>

<ul>
  <li>Концептуальная модель – говорит о том, какие данные используются системой и как данные связаны между собой. Подойдет если важно понять что за данные нужны в бизнес логике и как данные связаны между собой;</li>
  <li>Логическая модель – говорит о том, как данные структурируются в приложении. Поможет описать или посмотреть на схему бд. Можно сгенерировать автоматически;</li>
  <li>Физическая модель – говорит о том, как данные физически храниться будут. Сам не использовал, но допускаю, что поможет в инфраструктурных документах;</li>
</ul>

<p>Если нужно визуализировать схему бд, то тут два варианта: для мелких схем или для примеров лучше взять генераторы или diagram as a code инструменты, а для больших схем лучше либо взять инструменты для диаграм, либо посмотреть в сторону dbml, который можно использовать и в качестве генератора.</p>

<h2 id="что-еще-почитать-по-теме">Что еще почитать по теме</h2>

<p>Если тема data model заинтересовала, собрал четыре ссылки, по которым можно погрузиться в тему глубже. </p>

<ul>
  <li>[en] В статье не рассказывал про archimate. Хотя там так же <a href="https://eaprincipals.com/data-modeling-with-archi/">можно сделать нужную data model</a>. Если используете archi - ничего нового не узнаете, скорее всего;</li>
  <li>[en] <a href="https://www.mongodb.com/basics/data-modeling">Статья из блога mongoDB, в которой рассказывается data modelling</a>. В тексте найдете описание подхода, виды представлений, описание процесса, советы и еще больше инструментов и так далее;</li>
  <li>[en] <a href="https://www.thoughtspot.com/data-trends/data-modeling/conceptual-data-model-examples">Статья о том, как сделать концептуальную модель</a>, какие виды есть и в чем ее преимущества;</li>
  <li>[en] Серия статей о визуализации бд. По <a href="https://minimalmodeling.substack.com/p/visual-language-and-database-visualization">ссылке третья часть</a>, где упоминаются разные приложения для визуализации: MySQL Workbench,  Anchor,  TLDraw и Arrows.app;</li>
</ul>

<hr />

<p>Нашли опечатку или ошибку? Буду рад <a href="https://github.com/2pegramming/2pegramming.github.io/tree/master/questions">PR-у</a>.</p>

</div>

<!-- <div class="related"> -->
<!--   <h2>Related Posts</h2> -->
<!--   <ul class="related&#45;posts"> -->
<!--      -->
<!--       <li> -->
<!--         <h3> -->
<!--           <a href="/blogposts/retrospection-ecommerce/"> -->
<!--             Ретроспектива: ecommerce -->
<!--             <small>03 Jun 2020</small> -->
<!--           </a> -->
<!--         </h3> -->
<!--       </li> -->
<!--      -->
<!--   </ul> -->
<!-- </div> -->

    </div>

  </body>
</html>
